<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN 5000 - Effect on Coach Success</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./fourth_decisions.html">Data Exploration</a></li><li class="breadcrumb-item"><a href="./effect_on_coach_success.html">Effect on Coach Success</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DSAN 5000</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_gathering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Gathering</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Data Cleaning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_cleaning1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4th Down Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_cleaning2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Exploration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fourth_decisions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4th Down Decisions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./high_leverage_scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">High-Leverage Scenarios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./effect_on_coach_success.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Effect on Coach Success</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Naïve Bayes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./naive_bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naïve Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feature_record.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Record Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feature_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coach_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dimensionality_reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./decision_trees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Trees</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#all-4th-downs" id="toc-all-4th-downs" class="nav-link active" data-scroll-target="#all-4th-downs">All 4th Downs</a></li>
  <li><a href="#high-leverage-scenarios" id="toc-high-leverage-scenarios" class="nav-link" data-scroll-target="#high-leverage-scenarios">High-Leverage Scenarios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Effect on Coach Success</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>As we saw in the last step of our EDA, coaches are consistently far too conservative when it comes to fourth down decisions. We are trying to figure out why this may be the case. Two possible reasons immediately come to mind:</p>
<ol type="1">
<li>4th down decisions have less effect on the outcome of games than we think.</li>
<li>Coaches who are more conservative will keep their jobs longer, as being aggressive (and failing) on fourth down could be generally frowned upon by the NFL community.</li>
</ol>
<section id="all-4th-downs" class="level1">
<h1>All 4th Downs</h1>
<p>Lets explore the first reason. One simple measure of coach success season by season is winning percentage. To take a quick look this, we can look at how correct decision rate on 4th down compares to the winning percentage a coach had in that particular season. Alongside this process we will also look at the average EPA per play on 4th downs coaches had in go-for-it situations that season. EPA is a measure of success that stands for “Estimated Points Added” and it measures the estimated points a play will add to the total final score at the end of the game.</p>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">coach</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">team</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">correct_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.075</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">-0.278</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">-0.133</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.211</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.021</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.340</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.171</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.237</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">-0.382</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.269</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.230</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.170</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">0.096</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.422</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.353</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.286</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.021</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.360</td>
<td style="text-align: right;">0.875</td>
<td style="text-align: right;">0.097</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Now we have the winning percentage and epa alongside the correct decision rate on fourth down for every coach by season. Let’s take a closer look at this table and add averages for winning percentage, correct decision rate, and epa.</p>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">coach</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">team</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">correct_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_wins</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_correct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_wins</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_correct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_epa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.075</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">-0.278</td>
<td style="text-align: right;">0.657</td>
<td style="text-align: right;">-2.428</td>
<td style="text-align: right;">-1.450</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">-0.133</td>
<td style="text-align: right;">-0.653</td>
<td style="text-align: right;">0.567</td>
<td style="text-align: right;">-0.613</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.211</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">-0.326</td>
<td style="text-align: right;">-1.075</td>
<td style="text-align: right;">0.032</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.340</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.171</td>
<td style="text-align: right;">-0.326</td>
<td style="text-align: right;">0.218</td>
<td style="text-align: right;">-0.837</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.237</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">-0.382</td>
<td style="text-align: right;">-1.963</td>
<td style="text-align: right;">-0.808</td>
<td style="text-align: right;">-2.054</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.269</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.230</td>
<td style="text-align: right;">1.312</td>
<td style="text-align: right;">-0.489</td>
<td style="text-align: right;">1.482</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.170</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">0.096</td>
<td style="text-align: right;">0.657</td>
<td style="text-align: right;">-1.481</td>
<td style="text-align: right;">0.705</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.422</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.353</td>
<td style="text-align: right;">1.312</td>
<td style="text-align: right;">1.039</td>
<td style="text-align: right;">2.189</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.286</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">1.312</td>
<td style="text-align: right;">-0.324</td>
<td style="text-align: right;">0.274</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.360</td>
<td style="text-align: right;">0.875</td>
<td style="text-align: right;">0.097</td>
<td style="text-align: right;">1.967</td>
<td style="text-align: right;">0.417</td>
<td style="text-align: right;">0.710</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Now we can cross tabulate effectively.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="effect_on_coach_success_files/figure-html/cross_tab_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output-display">
<p><img src="effect_on_coach_success_files/figure-html/cross_tab2_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It looks as if decision rate on 4th down has little effect on the win rate of coaches, which makes sense as when looking at plays across an entire game, 4th down plays make up a small percentage of those plays. It would be worth looking at how influential 4th down plays are on the result of each game compared to other types of plays, though.</p>
<p>Having a good correct 4th down decision does seem to have more of an effect on EPA, however. This makes sense as EPA in this case is estimated points added on 4th down, meaning this metric is directly measuring success on 4th down <strong><em>only</em></strong>, rather than success across an entire game. It is not surprising that having a good correct 4th down decision rate would lead to a more positive 4th down success metric than a whole game success metric.</p>
<p>It is an encouraging sign to see that making “correct” decisions on 4th down leads to more points on those 4th down plays. This means it would be useful to explore how 4th down plays contribute to a team’s final score compared to plays on other downs. This may give us a better idea as to how these 4th down decisions affect the success of coaches across the entire game, rather than simply on 4th down.</p>
</section>
<section id="high-leverage-scenarios" class="level1">
<h1>High-Leverage Scenarios</h1>
<p>Let’s go back to our discussion involving high-leverage scenarios. What would happen if we did the same cross tabulation as above but only including high-leverage scenarios? In theory, this would give tell us more about a coaches success because these situations are single plays in which games are won and lost.</p>
<p>Here are the first few rows of the dataset showing high-leverage situations we were looking at earlier. This time though it is a larger dataset because I chose to remove the condition that <code>wp_succeed &gt; 0.95</code> as that limited us too much. Now the definition for a “high-leverage scenario” is one in which the difference in win probability between failing and succeeding in a 4th down attempt is 10%. This way we have 3,676 4th down situations to look at instead of only 113.</p>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">coach</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">posteam</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">defteam</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">qtr</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ydstogo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yardline_100</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">posteam_score</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">defteam_score</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">go_boost</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">go</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wp_fail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wp_succeed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wp_change</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fg_make_prob</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">miss_fg_wp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">make_fg_wp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">punt_wp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">Rex Ryan</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">14:19</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">9.71</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1.879</td>
<td style="text-align: right;">0.335</td>
<td style="text-align: right;">0.221</td>
<td style="text-align: right;">0.437</td>
<td style="text-align: right;">0.216</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.206</td>
<td style="text-align: right;">0.408</td>
<td style="text-align: right;">0.269</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">John Harbaugh</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">12:59</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-10.09</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.465</td>
<td style="text-align: right;">0.630</td>
<td style="text-align: right;">0.515</td>
<td style="text-align: right;">0.781</td>
<td style="text-align: right;">0.265</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.481</td>
<td style="text-align: right;">0.793</td>
<td style="text-align: right;">0.643</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">Rex Ryan</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">11:46</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.668</td>
<td style="text-align: right;">0.267</td>
<td style="text-align: right;">0.201</td>
<td style="text-align: right;">0.406</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.187</td>
<td style="text-align: right;">0.418</td>
<td style="text-align: right;">0.269</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">John Harbaugh</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">07:43</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-6.31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.973</td>
<td style="text-align: right;">0.804</td>
<td style="text-align: right;">0.681</td>
<td style="text-align: right;">0.899</td>
<td style="text-align: right;">0.218</td>
<td style="text-align: right;">0.765</td>
<td style="text-align: right;">0.656</td>
<td style="text-align: right;">0.820</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">John Harbaugh</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">05:42</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-7.08</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">0.846</td>
<td style="text-align: right;">0.733</td>
<td style="text-align: right;">0.936</td>
<td style="text-align: right;">0.203</td>
<td style="text-align: right;">0.892</td>
<td style="text-align: right;">0.706</td>
<td style="text-align: right;">0.837</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">Rex Ryan</td>
<td style="text-align: left;">BUF</td>
<td style="text-align: left;">BAL</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">04:43</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-2.08</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">0.047</td>
<td style="text-align: right;">0.204</td>
<td style="text-align: right;">0.156</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.041</td>
<td style="text-align: right;">0.196</td>
<td style="text-align: right;">0.083</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Applying the same transformations to this smaller set as we did to the set of every 4th down play gives us performance by coach in these scenarios.</p>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">coach</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">team</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">should_go</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shouldnt_go</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">-0.278</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">-0.133</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.286</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.171</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.400</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">-0.382</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.250</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.230</td>
<td style="text-align: right;">19</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Now we can cross tabulate as before.</p>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">coach</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">team</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">should_go</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shouldnt_go</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pct</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_wins</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_should</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_shouldnt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z_epa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_wins</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_should</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_shouldnt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">above_mean_epa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">-0.278</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.652</td>
<td style="text-align: right;">-1.801</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">-1.445</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.375</td>
<td style="text-align: right;">-0.133</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.655</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">-0.612</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-0.328</td>
<td style="text-align: right;">-1.801</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">0.031</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.286</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">-0.171</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">-0.328</td>
<td style="text-align: right;">-0.522</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">-0.834</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam Gase</td>
<td style="text-align: left;">NYJ</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.400</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">-0.382</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-1.961</td>
<td style="text-align: right;">-0.010</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">-2.047</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">0.250</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.230</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">-0.682</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">1.474</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">0.333</td>
<td style="text-align: right;">0.857</td>
<td style="text-align: right;">0.625</td>
<td style="text-align: right;">0.096</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.652</td>
<td style="text-align: right;">-0.308</td>
<td style="text-align: right;">-1.540</td>
<td style="text-align: right;">0.700</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.353</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">1.558</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">2.178</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0.400</td>
<td style="text-align: right;">0.909</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">-0.010</td>
<td style="text-align: right;">-0.801</td>
<td style="text-align: right;">0.271</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Andy Reid</td>
<td style="text-align: left;">KC</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.875</td>
<td style="text-align: right;">0.097</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1.958</td>
<td style="text-align: right;">0.438</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">0.706</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="effect_on_coach_success_files/figure-html/levergae_cross_tab_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="effect_on_coach_success_files/figure-html/leverage_cross_tab2_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see similar results here, where 4th down correct decision rate does not have much of an effect on a team’s record throughout the entire season, but there seems to be even more of an effect on 4th down EPA. This is useful information going into feature selection. We will attempt to predict 4th down EPA during a season, using a variety of features.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>