ggplot(cross_tab, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"))
ggplot(cross_tab, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"))
ggplot(cross_tab, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
View(fourth_decisions)
coaches <- fourth_decisions %>%
dplyr::select(coach, team = posteam, season, EPA) %>%
left_join(coach_record, by = c("coach", "season"))
coaches <- coaches %>%
mutate(pct = (wins + ties * 0.5) / (wins + losses + ties)) %>%
select(coach,
team,
season,
pct,
epa = EPA)
win_pct <- coaches %>%
left_join(fourth_decisions, by = c("coach", "team" = "posteam", "season")) %>%
select(coach,
team,
season,
correct_rate = should_go,
pct,
epa)
head(win_pct)
win_pct <- win_pct %>%
mutate(z_wins = as.numeric(scale(pct)),
z_correct = as.numeric(scale(correct_rate)),
z_epa = as.numeric(scale(epa)),
above_mean_wins = if_else(z_wins > 0, 1, 0),
above_mean_correct = if_else(z_correct > 0, 1, 0),
above_mean_epa = if_else(z_epa > 0, 1, 0))
cross_tab2 <- as.data.frame(table(win_pct$above_mean_epa,
win_pct$above_mean_correct)) %>%
rename(above_mean_epa = Var1,
above_mean_correct = Var2)
cross_tab2
ggplot(cross_tab2, aes(x = above_mean_epa, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
win_pct <- coaches %>%
left_join(fourth_decisions, by = c("coach", "team" = "posteam", "season")) %>%
select(coach,
team,
season,
correct_rate = should_go,
pct,
epa)
head(win_pct)
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2)
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2)
win_pct <- win_pct %>%
mutate(z_wins = as.numeric(scale(pct)),
z_correct = as.numeric(scale(correct_rate)),
z_epa = as.numeric(scale(epa)),
above_mean_wins = if_else(z_wins > 0, 1, 0),
above_mean_correct = if_else(z_correct > 0, 1, 0),
above_mean_epa = if_else(z_epa > 0, 1, 0))
kable(head(win_pct, 10))
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2)
ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
cross_tab2 <- as.data.frame(table(win_pct$above_mean_epa,
win_pct$above_mean_correct)) %>%
rename(above_mean_epa = Var1,
above_mean_correct = Var2)
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
p1 <- ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
p2 <- ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
grid.arrange(p1, p2, ncol = 2)
grid.arrange(p1, p2,
ncol = 2,
widths = c(2, 3))
grid.arrange(p1, p2,
ncol = 2,
widths = c(2, 2))
grid.arrange(p1, p2,
ncol = 2,
widths = c(4, 4))
View(cross_tab1)
View(cross_tab2)
View(cross_tab)
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2) %>%
mutate(above_mean_epa = above_mean_wins)
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2)
```{r}
ggplot(cross_tab1, aes(x = above_mean_wins, y = Freq)) +
geom_bar(stat = "identity") +
facet_wrap(~ above_mean_correct)
ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq)) +
geom_bar(stat = "identity") +
facet_wrap(~ above_mean_wins)
p1 <- ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
p2 <- ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True"))
p1
p2
p2 <- ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True")) +
theme(legend.position = "top")
p1
p2
p1 <- ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True")) +
theme(legend.position = "top")
p2 <- ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True")) +
theme(legend.position = "top")
p1
p2
plot_ly(data = fourth_position,
x = ~yardline_100,
y = ~ydstogo,
text = ~paste("go:", expected_go, "<br>count:", count),
type = "scatter",
mode = "markers",
marker = list(size = 9),
color = ~expected_go,
colors = (c("#FF0000", "#ecf54e", "#008000"))) %>%
layout(title = "When Coaches Should Go For It",
xaxis = list(title = "Yardline (Yards from Endzone)",
dtick = 10,
tick0 = 0,
tickmode = "linear"),
yaxis = list(title = "Yards to Go",
dtick = 5,
tick0 = 0,
tickmode = "linear")) %>%
colorbar(title = "")
library(nflverse)
plot_ly(data = fourth_position,
x = ~yardline_100,
y = ~ydstogo,
text = ~paste("go:", expected_go, "<br>count:", count),
type = "scatter",
mode = "markers",
marker = list(size = 9),
color = ~expected_go,
colors = (c("#FF0000", "#ecf54e", "#008000"))) %>%
layout(title = "When Coaches Should Go For It",
xaxis = list(title = "Yardline (Yards from Endzone)",
dtick = 10,
tick0 = 0,
tickmode = "linear"),
yaxis = list(title = "Yards to Go",
dtick = 5,
tick0 = 0,
tickmode = "linear")) %>%
colorbar(title = "")
library(nflverse)
library(nflverse)
library(tidyverse)
library(nflverse)
load("clean_data.Rdata")
library(nflverse)
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
display.brewer.all(type = 'div')
use_condaenv("r-env")
options(scipen = 999)
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
display.brewer.all(type = 'div')
use_condaenv("r-env")
options(scipen = 999)
load("clean_data.Rdata")
p <- ggplot(data = fourth_decisions, aes(x = should_go)) +
geom_histogram(binwidth = 0.05, fill = "#69b3a2", color="#e9ecef") +
scale_x_continuous(limits = c(0, 1.1), breaks = seq(0, 1, by = 0.1)) +
scale_y_continuous(limits = c(0, 70)) +
ggtitle("When NFL Coaches Go When They Should") +
xlab("") +
stat_bin(binwidth = 0.05,
geom='text',
aes(label=ifelse(..count.. != 0, ..count.., "")),
vjust = -0.5)
p1 <- ggplot(data = fourth_decisions, aes(x = shouldnt_go)) +
geom_histogram(binwidth = 0.05, fill = "#69b3a2", color="#e9ecef") +
scale_x_continuous(limits =c(0, 1.1), breaks = seq(0, 1, by = 0.1)) +
scale_y_continuous(limits = c(0, 200)) +
ggtitle("When NFL Coaches Don't Go When They Shouldn't") +
xlab("") +
stat_bin(binwidth = 0.05,
geom='text',
aes(label=ifelse(..count.. != 0, ..count.., "")),
vjust = -0.5)
grid.arrange(p, p1, ncol = 1)
fourth_position <- fourth_position %>%
filter(count > 10)
plot_ly(data = fourth_position,
x = ~yardline_100,
y = ~ydstogo,
text = ~paste("go:", actual_go, "<br>count:", count),
type = "scatter",
mode = "markers",
marker = list(size = 9),
color = ~actual_go,
colors = (c("#FF0000", "#ecf54e", "#008000"))) %>%
layout(title = "When Coaches Actually Go For It",
xaxis = list(title = "Yardline (Yards from Endzone)",
dtick = 10,
tick0 = 0,
tickmode = "linear"),
yaxis = list(title = "Yards to Go",
dtick = 5,
tick0 = 0,
tickmode = "linear")) %>%
colorbar(title = "")
plot_ly(data = fourth_position,
x = ~yardline_100,
y = ~ydstogo,
text = ~paste("go:", expected_go, "<br>count:", count),
type = "scatter",
mode = "markers",
marker = list(size = 9),
color = ~expected_go,
colors = (c("#FF0000", "#ecf54e", "#008000"))) %>%
layout(title = "When Coaches Should Go For It",
xaxis = list(title = "Yardline (Yards from Endzone)",
dtick = 10,
tick0 = 0,
tickmode = "linear"),
yaxis = list(title = "Yards to Go",
dtick = 5,
tick0 = 0,
tickmode = "linear")) %>%
colorbar(title = "")
library(nflverse)
win_pct <- win_pct %>%
mutate(z_wins = as.numeric(scale(pct)),
z_correct = as.numeric(scale(correct_rate)),
z_epa = as.numeric(scale(epa)),
above_mean_wins = if_else(z_wins > 0, 1, 0),
above_mean_correct = if_else(z_correct > 0, 1, 0),
above_mean_epa = if_else(z_epa > 0, 1, 0))
library(nflverse)
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
options(digits = 3)
load("clean_data.Rdata")
raw_games <- nflreadr::load_schedules()
home_games <- raw_games %>%
filter(season > 2015 & season < 2023,
game_type == "REG") %>%
dplyr::select(season,
result,
coach = home_coach) %>%
dplyr::mutate(win = if_else(result > 0, 1, 0),
loss = if_else(result < 0, 1, 0),
tie = if_else(result == 0, 1, 0)) %>%
dplyr::group_by(coach,
season) %>%
summarize(wins = sum(win),
losses = sum(loss),
ties = sum(tie))
away_games <- raw_games %>%
filter(season > 2015 & season < 2023,
game_type == "REG") %>%
dplyr::select(season,
result,
coach = away_coach) %>%
dplyr::mutate(win = if_else(result < 0, 1, 0),
loss = if_else(result > 0, 1, 0),
tie = if_else(result == 0, 1, 0)) %>%
dplyr::group_by(coach,
season) %>%
summarize(wins = sum(win),
losses = sum(loss),
ties = sum(tie))
coach_record <- away_games %>%
left_join(home_games, by = c("coach", "season")) %>%
mutate(wins = wins.x + wins.y,
losses = losses.x + losses.y,
ties = ties.x + ties.y) %>%
select(coach, season, wins, losses, ties)
rm(home_games, away_games, raw_games)
coaches <- fourth_decisions %>%
dplyr::select(coach, team = posteam, season, EPA) %>%
left_join(coach_record, by = c("coach", "season"))
coaches <- coaches %>%
mutate(pct = (wins + ties * 0.5) / (wins + losses + ties)) %>%
select(coach,
team,
season,
pct,
epa = EPA)
win_pct <- coaches %>%
left_join(fourth_decisions, by = c("coach", "team" = "posteam", "season")) %>%
select(coach,
team,
season,
correct_rate = should_go,
pct,
epa)
kable(head(win_pct, 10))
win_pct <- win_pct %>%
mutate(z_wins = as.numeric(scale(pct)),
z_correct = as.numeric(scale(correct_rate)),
z_epa = as.numeric(scale(epa)),
above_mean_wins = if_else(z_wins > 0, 1, 0),
above_mean_correct = if_else(z_correct > 0, 1, 0),
above_mean_epa = if_else(z_epa > 0, 1, 0))
kable(head(win_pct, 10))
cross_tab1 <- as.data.frame(table(win_pct$above_mean_wins,
win_pct$above_mean_correct)) %>%
rename(above_mean_wins = Var1,
above_mean_correct = Var2)
cross_tab2 <- as.data.frame(table(win_pct$above_mean_epa,
win_pct$above_mean_correct)) %>%
rename(above_mean_epa = Var1,
above_mean_correct = Var2)
ggplot(cross_tab1, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_wins))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down Wins") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True")) +
theme(legend.position = "top")
ggplot(cross_tab2, aes(x = above_mean_correct, y = Freq, fill = factor(above_mean_epa))) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "Above Mean Correct Decision Rate on 4th Down",
y = "Frequency",
fill = "Above Mean 4th Down EPA") +
scale_fill_manual(values = c("0" = "orange", "1" = "blue"), labels = c("False", "True")) +
theme(legend.position = "top")
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
display.brewer.all(type = 'div')
use_condaenv("r-env")
options(scipen = 999)
load("clean_data.Rdata")
p <- ggplot(data = fourth_decisions, aes(x = should_go)) +
geom_histogram(binwidth = 0.05, fill = "#69b3a2", color="#e9ecef") +
scale_x_continuous(limits = c(0, 1.1), breaks = seq(0, 1, by = 0.1)) +
scale_y_continuous(limits = c(0, 70)) +
ggtitle("When NFL Coaches Go When They Should") +
xlab("") +
stat_bin(binwidth = 0.05,
geom='text',
aes(label=ifelse(..count.. != 0, ..count.., "")),
vjust = -0.5)
p1 <- ggplot(data = fourth_decisions, aes(x = shouldnt_go)) +
geom_histogram(binwidth = 0.05, fill = "#69b3a2", color="#e9ecef") +
scale_x_continuous(limits =c(0, 1.1), breaks = seq(0, 1, by = 0.1)) +
scale_y_continuous(limits = c(0, 200)) +
ggtitle("When NFL Coaches Don't Go When They Shouldn't") +
xlab("") +
stat_bin(binwidth = 0.05,
geom='text',
aes(label=ifelse(..count.. != 0, ..count.., "")),
vjust = -0.5)
grid.arrange(p, p1, ncol = 1)
fourth_position <- fourth_position %>%
filter(count > 10)
plot_ly(data = fourth_position,
x = ~yardline_100,
y = ~ydstogo,
text = ~paste("go:", actual_go, "<br>count:", count),
type = "scatter",
mode = "markers",
marker = list(size = 8),
color = ~actual_go,
colors = (c("#FF0000", "#ecf54e", "#008000"))) %>%
layout(title = "When Coaches Actually Go For It",
xaxis = list(title = "Yardline (Yards from Endzone)",
dtick = 10,
tick0 = 0,
tickmode = "linear"),
yaxis = list(title = "Yards to Go",
dtick = 5,
tick0 = 0,
tickmode = "linear")) %>%
colorbar(title = "")
View(fourth_decisions)
library(reticulate)
use_condaenv("r-env")
reticulate::repl_python()
