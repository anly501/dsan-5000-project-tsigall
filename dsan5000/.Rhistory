marker = list(size = 8)) %>%
hide_colorbar()
labels <- c("Season: ", season,
"<br>Coach: ", coach,
"<br>Team: ", posteam,
"<br>Time: ", time,
"<br>Score: ", posteam_score, "-", defteam_score,
"<br>Win Probability: ", sprintf("%.2f", wp),
sprintf("%.2f", wp_fail),
sprintf("%.2f", wp_succeed),
sprintf("%.2f", wp_change),
"<br>Punt: ")
labels <- c("Season: ", leverage$season,
"<br>Coach: ", leverage$coach,
"<br>Team: ", leverage$posteam,
"<br>Time: ", leverage$time,
"<br>Score: ", leverage$posteam_score, "-", leverage$defteam_score,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
sprintf("%.2f", leverage$wp_fail),
sprintf("%.2f", leverage$wp_succeed),
sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach,
"<br>Team: ", leverage$posteam,
"<br>Time: ", leverage$time,
"<br>Score: ", leverage$posteam_score, "-", leverage$defteam_score,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
sprintf("%.2f", leverage$wp_fail),
sprintf("%.2f", leverage$wp_succeed),
sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam,
"<br>Time: ", leverage$time,
"<br>Score: ", leverage$posteam_score, "-", leverage$defteam_score,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
sprintf("%.2f", leverage$wp_fail),
sprintf("%.2f", leverage$wp_succeed),
sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br",
leverage$posteam_score, "-", leverage$defteam_score, "/", time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
sprintf("%.2f", leverage$wp_fail),
sprintf("%.2f", leverage$wp_succeed),
sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
sprintf("%.2f", leverage$wp_fail),
sprintf("%.2f", leverage$wp_succeed),
sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), sprintf("%.2f", leverage$wp_succeed),
"<br>WP Change: ", sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>WP Change: ", sprintf("%.2f", leverage$wp_change),
"<br>Punt: ")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", leverage$punt_wp)
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp))
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra></extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8)) %>%
hide_colorbar()
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = paste('<i>Price</i>: $%{y:.2f}',
'<br><b>X</b>: %{x}<br>',
'<b>%{text}</b><extra></extra>')) %>%
hide_colorbar()
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
text = labels,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = paste("<extra></extra>")) %>%
hide_colorbar()
hovertemplate = labels %>%
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra><extra>")
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra><extra>")
plot_ly(data = leverage,
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra><extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = labels) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", leverage$fg_make_prob,
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra></extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = labels) %>%
hide_colorbar()
labels <- paste("Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", sprintf("%.2f", leverage$fg_make_prob),
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra></extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = labels) %>%
hide_colorbar()
labels <- paste("Yardline/Distance: ", leverage$ydstogo, "/", leverage$yardline_100,
"<br>Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", sprintf("%.2f", leverage$fg_make_prob),
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra></extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = labels) %>%
hide_colorbar()
labels <- paste(leverage$ydstogo, "to go /", leverage$yardline_100, "yardline",
"<br>Season: ", leverage$season,
"<br>Coach: ", leverage$coach, "-", leverage$posteam, "<br>",
leverage$posteam_score, "-", leverage$defteam_score, "/", leverage$time,
"<br>Win Probability: ", sprintf("%.2f", leverage$wp),
"<br>WP Fail / Succeed: ", sprintf("%.2f", leverage$wp_fail), "/", sprintf("%.2f", leverage$wp_succeed),
"<br>FG Make Prob: ", sprintf("%.2f", leverage$fg_make_prob),
"<br>Punt WP: ", sprintf("%.2f", leverage$punt_wp),
"<extra></extra>")
plot_ly(data = leverage,
x = ~yardline_100,
y = ~ydstogo,
type = "scatter",
mode = "markers",
color = ~go,
colors = c("#FF0000", "#008800"),
marker = list(size = 8),
hovertemplate = labels) %>%
hide_colorbar()
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
options(digits = 3)
load("clean_data.Rdata")
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam
defteam,
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam,
yardline_100,
posteam_score,
defteam_score,
go_boost,
go,
epa,
wp,
wp_fail,
wp_succeed,
wp_change,
fg_make_prob,
miss_fg_wp,
make_fg_wp,
punt_wp) %>%
filter(abs(wp_change) > .2,
wp_succeed > .95,
qtr == 4)
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
options(digits = 3)
load("clean_data.Rdata")
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam,
yardline_100,
posteam_score,
defteam_score,
go_boost,
go,
epa,
wp,
wp_fail,
wp_succeed,
wp_change,
fg_make_prob,
miss_fg_wp,
make_fg_wp,
punt_wp) %>%
filter(abs(wp_change) > .2,
wp_succeed > .95,
qtr == 4)
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam
defteam,
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam,
defteam,
qtr,
time,
ydstogo,
yardline_100,
posteam_score,
defteam_score,
go_boost,
go,
epa,
wp,
wp_fail,
wp_succeed,
wp_change,
fg_make_prob,
miss_fg_wp,
make_fg_wp,
punt_wp) %>%
filter(abs(wp_change) > .2,
wp_succeed > .95,
qtr == 4)
library(nflverse)
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
use_condaenv("r-env")
options(scipen = 999)
fourth_downs <- raw_data %>%
filter(!is.na(go_boost) & !is.na(go)) %>%
select(season, home_coach, away_coach, posteam, def_team, posteam_type, qtr, time, ydstogo, yardline_100, posteam_score, defteam_score, posteam, go_boost, go, epa, wp_fail, wp_succeed, wp, fg_make_prob, miss_fg_wp, make_fg_wp, punt_wp)
load("raw_nfl.Rdata")
fourth_downs <- raw_data %>%
filter(!is.na(go_boost) & !is.na(go)) %>%
select(season, home_coach, away_coach, posteam, def_team, posteam_type, qtr, time, ydstogo, yardline_100, posteam_score, defteam_score, posteam, go_boost, go, epa, wp_fail, wp_succeed, wp, fg_make_prob, miss_fg_wp, make_fg_wp, punt_wp)
View(raw_data)
View(raw_data)
fourth_downs <- raw_data %>%
filter(!is.na(go_boost) & !is.na(go)) %>%
select(season, home_coach, away_coach, posteam, defteam, posteam_type, qtr, time, ydstogo, yardline_100, posteam_score, defteam_score, posteam, go_boost, go, epa, wp_fail, wp_succeed, wp, fg_make_prob, miss_fg_wp, make_fg_wp, punt_wp)
head(fourth_downs)
codebook <- data.frame("Variable" = names(fourth_downs),
"Description" = c("Season",
"Home Team Coach",
"Away Team Coach",
"Offense Team",
"Defense Team",
"Offense Home or Away",
"Quarter",
"Time left in Quarter",
"Yards to Go",
"Yardline Relative to End Zone",
"Offense Score",
"Defense Score",
"Change in Win Probability if Conversion Attempted",
"Conversion Attempted (T/F)",
"Estimated Points Added as a Result of the Play",
"Win Probability if Conversion Fails",
"Win Probability if Conversion Succeeds",
"Win Probability at Time of Play",
"Chance of Making Field Goal",
"Win Probability if Field Goal Misses",
"Win Probability if Field Goal is Made",
"Win Probability if Team Punts"))
kable(codebook)
save(fourth_decisions, fourth_downs, fourth_position, file = "clean_data.Rdata")
library(tidyverse)
library(ggplot2)
library(grid)
library(reticulate)
library(kableExtra)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(scales)
options(digits = 3)
load("clean_data.Rdata")
leverage <- fourth_downs %>%
mutate(wp_change = wp_succeed - wp_fail,
coach = if_else(posteam_type == "home", home_coach, away_coach)) %>%
select(season,
coach,
posteam,
defteam,
qtr,
time,
ydstogo,
yardline_100,
posteam_score,
defteam_score,
go_boost,
go,
epa,
wp,
wp_fail,
wp_succeed,
wp_change,
fg_make_prob,
miss_fg_wp,
make_fg_wp,
punt_wp) %>%
filter(abs(wp_change) > .2,
wp_succeed > .95,
qtr == 4)
kable(head(leverage, 10))
View(leverage)
